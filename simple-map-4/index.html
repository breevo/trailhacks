

<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">

  <link rel="stylesheet" href="https://js.arcgis.com/4.0beta3/esri/css/main.css"></p>
  <script src="https://js.arcgis.com/4.0beta3/"></script>
	<script>
	   var map;
	  
	  require(["esri/Map",
      "esri/layers/OpenStreetMapLayer",
      "esri/views/MapView",
      "esri/views/SceneView",
      "esri/layers/ArcGISDynamicLayer",
      "dojo/_base/array",
      "dojo/request/script",
      "esri/layers/GraphicsLayer",
      "esri/Graphic",
      "esri/geometry/Point",
      "esri/symbols/SimpleMarkerSymbol",
      "esri/PopupTemplate",
      "esri/widgets/Home",
      "esri/widgets/Home/HomeViewModel",
		  "dojo/parser", "dojo/dom-style",
	      "dojo/on", 
	      "dojo/dom",
          "esri/layers/FeatureLayer",
          "esri/geometry/Extent",        
          "dojo/dom-construct",
	        "esri/symbols/SimpleLineSymbol",
	        "esri/symbols/SimpleFillSymbol",
	        "esri/symbols/TextSymbol",
	        "esri/renderers/SimpleRenderer",
	        "esri/Color",
	   
		  "dijit/layout/BorderContainer", "dijit/layout/ContentPane",
	      "dojo/domReady!"], function(Map, OpenStreeMapLayer, MapView, SceneView, ArcGISDynamicLayer, array, script, GraphicsLayer,
          Graphic, Point, SimpleMarkerSymbol, PopupTemplate, Home, HomeVM, 
          parser, domStyle, on, dom, FeatureLayer, Extent, domConstruct, 
          SimpleLineSymbol, SimpleFillSymbol, TextSymbol, SimpleRenderer, LabelClass, Color) {


      var graphicsLayer = new GraphicsLayer();

      script.get("https://api.instagram.com/v1/media/search?lat=30.369776&lng=-84.273709&access_token=16384709.6ac06b4.49b97800d7fd4ac799a2c889f50f2587", {
        jsonp: "callback"
      }).then(function(data){
        array.forEach(data.data, function(entry, i) {
          if (entry.location) {
             console.log(entry.location.latitude + " " + entry.location.longitude);    
             
              var point = new Point({
                longitude: entry.location.longitude,
                latitude: entry.location.latitude
              });

              //Create a symbol for drawing the point
              var markerSymbol = new SimpleMarkerSymbol({
                color: [226, 119, 40],
                outline: new SimpleLineSymbol({
                  color: [255, 255, 255],
                  width: 2
                })
              });

              //Create a graphic and add the geometry and symbol to it
              var pointGraphic = new Graphic({
                geometry: point,
                symbol: markerSymbol,
                height: 320,
                popupTemplate: new PopupTemplate({
                    title: "{caption}",
                    content: "<img src='{src}' width='300' height='320'>"
                }),
                attributes: {
                  caption: entry.caption.text,
                  src: entry.images.low_resolution.url
                }
              });
              graphicsLayer.add(pointGraphic);
          }
        });
        // Do something with the response data
      }, function(err){
        // Handle the error condition
      });

      

        var template = new PopupTemplate({
          title: "{TRAILNAME}",
          content: "<p>{LOOPNAME}</p>" +
            "<p>{TRAIL_LEN} {TRAILSURFACE}</p>" +
            "<a href='{TRAILMAPWEBLINK}' target='_new'>Map</a> <a href='{CONTACTWEBLINK}' target='_new'>Contact</a>",
          fieldInfos: []
        });

        var trailRenderer = new SimpleRenderer({
          symbol: new SimpleLineSymbol({color: "#00FF00", width: 4.5}),
          visualVariables: [{
            type: "opacityInfo",
            opacityValues: [ 0.5 ]
          }]
        });

        //add a layer to the map
        var featureLayer = new FeatureLayer({url: "http://tlcgisinter.leoncountyfl.gov/arcgis/rest/services/Public/TLC_Inter_OverlayTrailahassee_D_WM/MapServer/3",
          renderer: trailRenderer,
          showLabels: true,
          outFields: ["*"],
          popupTemplate: template
          // definitionExpression: "MTN_BIKING = 'Yes' OR BIKING = 'Yes'"
        });

        featureLayer.then(function() {
          view.animateTo({
            center: [-84.291221, 30.4343218],
            zoom: 12,
          });
        });

      var trailTypeLayer = new ArcGISDynamicLayer({
        url: "http://tlcgisinter.leoncountyfl.gov/arcgis/rest/services/Public/TLC_Inter_OverlayTrailahassee_D_WM/MapServer",
        visibleLayers: [1, 2, 4],
        showLabels: true,
        opacity: 0.9
      });
		  
        map = new Map({
          basemap: "topo",
          layers: [featureLayer, trailTypeLayer, graphicsLayer]
        });

        var view = new MapView({
          container: "mapDiv",
          center: [-84.291221, 30.4343218],
          zoom: 11,
          map: map 
        });


          // Wire UI Events
          on(dom.byId("btnStreets"),"click", function() { 
            map.basemap = "osm";
          });
          on(dom.byId("btnSatellite"),"click", function() { 
            map.basemap = "satellite";
          });
          on(dom.byId("btnTopo"),"click", function() { 
            map.basemap = "topo";
          });

          var homeBtn = new Home({
            viewModel: new HomeVM({
              view: view
            })
          }, "homediv");
          homeBtn.startup();

	  });

	</script>

	<style>
	  html, body, #mapDiv {
	    padding: 0;
	    margin: 0;
	    height: 100%;
	  }
	  
	  .panel-heading, .panel-title {
	  	padding: 0;
	  	margin: 0;
	  }

    #homediv {
      position: absolute;
      top: 80px;
      left: 15px;
      z-index: 50;
    }
	  
	  .panel-primary {
		z-index: 100;
		padding: 10px 10px 10px 10px;
		position: absolute;
		bottom: 34px;
		left: 14px;
		border: 1px solid #EAEAEA;
		background: rgba(255, 255, 255, 0.5);
	  }
	</style>



	
    <title></title>
  </head>


  <body class="claro">

<div class="panel panel-primary panel-fixed">
<!--       <div class="panel-heading">
        <h3 class="panel-title">Map</h3>
      </div>
 -->      <div class="panel-body">
        <div class="btn-toolbar">
          <div class="btn-group">
            <button id="btnStreets" class="btn btn-default">Street Map</button>
            <button id="btnSatellite" class="btn btn-default">Satellite</button>
            <button id="btnTopo" class="btn btn-default">Topography</button>
          </div>  
        </div>
      </div>
    </div>

    <div id="mapDiv">
      <div id="homediv"></div>
    </div>
  </body>

  
  
</html>

